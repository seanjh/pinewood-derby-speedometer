<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Dynamic Grid with Debounce</title>
	<style>
		.grid-container {
			display: grid;
			grid-template-columns: repeat(auto-fill, 18px);
			grid-template-rows: repeat(20, 18px)
		}

		.grid-item {
			width: 18px;
			height: 18px;
			background-color: #f0f0f0;
		}

		.loading-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(255, 255, 255, 0.7);
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 2rem;
			display: none;
		}
	</style>
</head>

<body>

	<div id="loading" class="loading-overlay">Loading...</div>
	<div id="grid-container" class="grid-container"></div>

	<script>
		// TODO(sean) generate random series (rolling N values)
		// TODO(sean) populate graph from series

		const LIMIT = 10;
		const data = [];

		function getRandomInt(max) {
			return Math.floor(Math.random() * max);
		}


		function generateData() {
			setTimeout(() => {
				const point = getRandomInt(100);
				data.push(point);
				if (data.length > LIMIT) {
					data.shift();
				}
				console.debug(`data: length=${data.length}, last=${point}`);
				generateData();
			}, 1000);
		}
		generateData();

		function showLoading() {
			document.getElementById('loading').style.display = 'none'; // Hide loading message
		}

		function hideLoading() {
			document.getElementById('loading').style.display = 'flex'; // Show loading message
		}

		function createGridItems() {
			const gridContainer = document.getElementById('grid-container');
			const itemWidth = 18;
			const columns = Math.floor(window.innerWidth / itemWidth);
			const rows = 20;
			const numberOfItems = columns * rows;
			console.debug(`columns = ${columns}, rows = ${rows}, total = ${numberOfItems}`);

			gridContainer.innerHTML = '';

			for (let x = 0; x < columns; x++) {
				for (let y = 0; y < rows; y++) {
					// TODO lookup
				}
			}
			for (let i = 0; i < numberOfItems; i++) {
				const item = document.createElement('div');
				item.classList.add('grid-item');
				gridContainer.appendChild(item);
			}
			showLoading();
		}
		createGridItems();

		function debounce(func, timeout = 300) {
			let timer;
			return (...args) => {
				clearTimeout(timer);
				hideLoading();
				timer = setTimeout(() => func.apply(this, args), timeout);
			};
		}

		// Debounced version of createGridItems to improve performance during resize
		const debouncedCreateGridItems = debounce(createGridItems);

		window.addEventListener('resize', debouncedCreateGridItems);
	</script>

</body>

</html>
